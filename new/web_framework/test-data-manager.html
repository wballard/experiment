<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Manager Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #fff; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .success { background: #2d5a2d; }
        .error { background: #5a2d2d; }
        .info { background: #2d2d5a; }
        button { margin: 5px; padding: 10px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background: #0066cc; color: white; }
        .btn-success { background: #006600; color: white; }
        .btn-warning { background: #cc6600; color: white; }
        .btn-danger { background: #cc0000; color: white; }
        pre { background: #333; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>CourierDataManager Test Page</h1>
    
    <div id="status"></div>
    
    <h2>Test Actions</h2>
    <button class="btn-primary" onclick="testInitialization()">Test Initialization</button>
    <button class="btn-success" onclick="testWeaponCreation()">Create Test Weapon</button>
    <button class="btn-success" onclick="testArmorCreation()">Create Test Armor</button>
    <button class="btn-warning" onclick="testLoadoutActivation()">Activate Boss Killer</button>
    <button class="btn-primary" onclick="testSkillInvestment()">Invest Skill Point</button>
    <button class="btn-danger" onclick="clearAllData()">Clear All Data</button>
    
    <h2>Current Data</h2>
    <button class="btn-primary" onclick="showDataSummary()">Show Data Summary</button>
    <button class="btn-primary" onclick="exportAllData()">Export All Data</button>
    
    <div id="results"></div>

    <script src="assets/js/data-manager.js"></script>
    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            results.appendChild(div);
            results.scrollTop = results.scrollHeight;
        }

        function testInitialization() {
            if (window.CourierData) {
                log('‚úÖ CourierDataManager successfully loaded', 'success');
                log(`Version: ${window.CourierData.version}`, 'info');
                const summary = window.CourierData.getDataSummary();
                log(`Data summary: <pre>${JSON.stringify(summary, null, 2)}</pre>`, 'info');
            } else {
                log('‚ùå CourierDataManager not found', 'error');
            }
        }

        function testWeaponCreation() {
            if (!window.CourierData) {
                log('‚ùå Data manager not available', 'error');
                return;
            }

            const testWeapon = {
                name: 'Test Elite Pistol',
                type: 'weapon',
                weaponType: 'handgun',
                rarity: 'epic',
                icon: 'üî´',
                damage: { min: 80, max: 120 },
                fireRate: 300,
                magazineSize: 15,
                reloadTime: 1.8,
                range: 30,
                critChance: 20,
                critMultiplier: 2.5,
                description: 'A test weapon created by the data manager'
            };

            const success = window.CourierData.addWeapon(testWeapon);
            if (success) {
                log('‚úÖ Test weapon created successfully', 'success');
                const weapons = window.CourierData.getWeaponsData();
                log(`Total weapons: ${weapons.collection.length}`, 'info');
            } else {
                log('‚ùå Failed to create test weapon', 'error');
            }
        }

        function testArmorCreation() {
            if (!window.CourierData) {
                log('‚ùå Data manager not available', 'error');
                return;
            }

            const testArmor = {
                name: 'Test Combat Vest',
                type: 'armor',
                slot: 'chest',
                rarity: 'rare',
                icon: 'ü¶∫',
                armor: 150,
                health: 200,
                resistances: {
                    fire: 10,
                    ice: 5,
                    electric: 15
                },
                description: 'A test armor piece created by the data manager'
            };

            const success = window.CourierData.addArmor(testArmor);
            if (success) {
                log('‚úÖ Test armor created successfully', 'success');
                const armor = window.CourierData.getArmorData();
                log(`Total armor pieces: ${armor.collection.length}`, 'info');
            } else {
                log('‚ùå Failed to create test armor', 'error');
            }
        }

        function testLoadoutActivation() {
            if (!window.CourierData) {
                log('‚ùå Data manager not available', 'error');
                return;
            }

            const success = window.CourierData.activateLoadout('boss-killer');
            if (success) {
                log('‚úÖ Boss Killer loadout activated', 'success');
                const loadouts = window.CourierData.getLoadoutsData();
                log(`Active loadout: ${loadouts.active}`, 'info');
                
                const skills = window.CourierData.getSkillTreesData();
                log(`Skills after activation: <pre>${JSON.stringify(skills.invested.class, null, 2)}</pre>`, 'info');
            } else {
                log('‚ùå Failed to activate loadout', 'error');
            }
        }

        function testSkillInvestment() {
            if (!window.CourierData) {
                log('‚ùå Data manager not available', 'error');
                return;
            }

            const success = window.CourierData.investSkillPoint('dead-eye', 'class');
            if (success) {
                log('‚úÖ Skill point invested in Dead Eye', 'success');
                const skills = window.CourierData.getSkillTreesData();
                log(`Available points: ${skills.available}`, 'info');
                log(`Dead Eye level: ${skills.invested.class['dead-eye'] || 0}`, 'info');
            } else {
                log('‚ùå Failed to invest skill point (no points available?)', 'error');
            }
        }

        function showDataSummary() {
            if (!window.CourierData) {
                log('‚ùå Data manager not available', 'error');
                return;
            }

            const summary = window.CourierData.getDataSummary();
            log(`<pre>Data Summary:\n${JSON.stringify(summary, null, 2)}</pre>`, 'info');
        }

        function exportAllData() {
            if (!window.CourierData) {
                log('‚ùå Data manager not available', 'error');
                return;
            }

            const exportData = window.CourierData.exportData();
            const dataStr = JSON.stringify(exportData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'courier_game_data.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            log('‚úÖ Data exported to download', 'success');
        }

        function clearAllData() {
            if (!window.CourierData) {
                log('‚ùå Data manager not available', 'error');
                return;
            }

            if (confirm('Are you sure you want to clear ALL game data?')) {
                window.CourierData.clearAllData();
                log('üóëÔ∏è All data cleared and reinitialized', 'warning');
            }
        }

        // Initialize test on page load
        document.addEventListener('DOMContentLoaded', () => {
            log('Data Manager Test Page loaded', 'info');
            
            // Set status
            const status = document.getElementById('status');
            if (window.CourierData) {
                status.innerHTML = '<div class="test-result success">‚úÖ CourierDataManager is ready</div>';
            } else {
                status.innerHTML = '<div class="test-result error">‚ùå CourierDataManager not loaded</div>';
            }
        });
    </script>
</body>
</html>