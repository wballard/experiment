<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Inventory - Courier</title>
    <link rel="stylesheet" href="assets/css/design-system.css?v=11">
    <link rel="stylesheet" href="assets/css/main.css?v=11">
    <link rel="stylesheet" href="assets/css/inventory.css?v=11">
</head>
<body>
    <div class="page-container">
        <h1>Test Inventory Loading</h1>
        
        <div id="debug-info" style="background: #222; padding: 20px; margin: 20px 0; font-family: monospace; font-size: 12px;">
            <h3>Debug Information:</h3>
            <div id="debug-output"></div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Test Inventory Items</h2>
            </div>
            
            <div class="inventory-grid" id="inventory-grid">
                <div class="page-loader">
                    <p>Loading inventory items...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Initialize global game state -->
    <script>
        window.CourierGame = {
            data: {
                items: {},
                playerLevel: 60,
                paragonLevel: 40,
                equippedItems: {}
            }
        };
    </script>
    <script src="assets/js/inventory.js"></script>
    <script>
        const debugOutput = document.getElementById('debug-output');
        
        function addDebug(message) {
            console.log(message);
            debugOutput.innerHTML += '<div>' + message + '</div>';
        }
        
        async function testInventoryLoading() {
            addDebug('=== STARTING INVENTORY TEST ===');
            
            try {
                // Test 1: Check if InventorySystem exists
                addDebug('Test 1: InventorySystem exists: ' + (!!window.InventorySystem));
                
                if (!window.InventorySystem) {
                    addDebug('ERROR: InventorySystem not found!');
                    return;
                }
                
                // Test 2: Try to fetch the database directly
                addDebug('Test 2: Fetching item database...');
                const response = await fetch('assets/data/item-database.json');
                addDebug('Database fetch response: ' + response.status + ' ' + response.statusText);
                
                if (response.ok) {
                    const database = await response.json();
                    const totalItems = database.weapons.length + database.armor.length + database.bracers.length;
                    addDebug('Database loaded successfully: ' + totalItems + ' total items');
                    addDebug('Weapons: ' + database.weapons.length + ', Armor: ' + database.armor.length + ', Bracers: ' + database.bracers.length);
                } else {
                    addDebug('ERROR: Failed to load database');
                    return;
                }
                
                // Test 3: Try generating random inventory
                addDebug('Test 3: Generating random inventory...');
                const randomInventory = await window.InventorySystem.generateRandomInventory();
                addDebug('Generated inventory: ' + randomInventory.length + ' items');
                randomInventory.forEach((item, i) => {
                    addDebug(`  ${i+1}. ${item.name} (${item.type}, ${item.rarity})`);
                });
                
                // Test 4: Load inventory data
                addDebug('Test 4: Loading inventory data...');
                await window.InventorySystem.loadInventoryData();
                addDebug('CourierGame.data.items keys: ' + Object.keys(window.CourierGame.data.items).length);
                
                // Test 5: Populate inventory
                addDebug('Test 5: Populating inventory...');
                window.InventorySystem.populateInventory();
                
                // Check final state
                const inventoryGrid = document.getElementById('inventory-grid');
                const itemElements = inventoryGrid.querySelectorAll('.inventory-item');
                addDebug('Final result: ' + itemElements.length + ' items in DOM');
                
                addDebug('=== INVENTORY TEST COMPLETE ===');
                
            } catch (error) {
                addDebug('ERROR in test: ' + error.message);
                console.error('Full error:', error);
            }
        }
        
        // Start test when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            addDebug('DOM Content Loaded - starting test in 1 second...');
            setTimeout(testInventoryLoading, 1000);
        });
    </script>
</body>
</html>